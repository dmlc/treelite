# Starter pipeline
# Start with a minimal pipeline that you can customize to build and deploy your code.
# Add steps that build, run tests, deploy, and more:
# https://aka.ms/yaml

trigger:
- master

pool:
  vmImage: 'ubuntu-latest'

steps:
- checkout: self
  submodules: recursive
- script: tests/ci_build/ci_build.sh cpu tests/ci_build/build_via_cmake.sh -DENABLE_PROTOBUF=ON
  displayName: 'Building Treelite...'
- script: tests/ci_build/ci_build.sh cpu bash -c "cd python/ && rm -rf dist/* && rm -rf build/* && python setup.py bdist_wheel --universal"
  displayName: 'Packaging Python wheel for Treelite...'
- task: PublishPipelineArtifact@0
  inputs:
    artifactName: 'python_whl'
    targetPath: 'python/dist/'
